FROM node:20-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y python3 make g++ git && rm -rf /var/lib/apt/lists/*

# Install pnpm
RUN npm install -g pnpm

# 1. Copy and Build SDK
COPY sui-agent-kit /app/sui-agent-kit
WORKDIR /app/sui-agent-kit
ENV CI=true
RUN pnpm install
RUN pnpm build

# 2. Setup Bridge
WORKDIR /app/nautilus
COPY nautilus/package.json .
COPY nautilus/tsconfig.json .
COPY nautilus/nimbus_bridge.ts .

# Install dependencies
# We use npm here as the bridge project seems to use npm (package-lock.json present in file list? No, only package.json seen in cat, but usually npm)
# We link the local sdk
RUN npm install
RUN npm install /app/sui-agent-kit

EXPOSE 3001

CMD ["npm", "run", "start"]
